# Telegram Bot RAG System

–ê–≤—Ç–æ–Ω–æ–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Telegram-–±–æ—Ç–∞–º–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º LLM –∏ RAG (Retrieval-Augmented Generation).

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ü§ñ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–æ–ª–∏ –±–æ—Ç–æ–≤ (TECH, FRIEND, ADVISOR, AGITATOR, OPERATOR)
- üìö RAG —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –∑–Ω–∞–Ω–∏–π –∏–∑ GitHub/GitLab
- üéØ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫–æ—Ä–∏–Ω–≥ –∏ –≤—ã–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π LLM-–º–æ–¥–µ–ª–∏
- üåê –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–≤–æ–¥–æ–º
- üîí –°–∏—Å—Ç–µ–º–∞ —á–µ—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- üíæ Persistent –æ—á–µ—Ä–µ–¥–∏ –∏ –∏—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- üé® –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ tkinter
- ‚ö° –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–µ –∞–≥–µ–Ω—Ç—ã –¥–ª—è –≤–æ–≤–ª–µ—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
```

2. –°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–ª—é—á–∏:
```bash
cp .env.example .env
```

3. –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
- `OPENROUTER_API_KEY` - –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ LLM –º–æ–¥–µ–ª—è–º
- `TELEGRAM_BOT_TOKEN` - —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞
- `PINECONE_API_KEY` –∏–ª–∏ `QDRANT_API_KEY` - –¥–ª—è vector database

4. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
- `TRANSLATE_API_KEY` - –¥–ª—è Google Translate API
- `GITHUB_TOKEN` / `GITLAB_TOKEN` - –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º
- `REPO_URL` - URL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏

## –ó–∞–ø—É—Å–∫

```bash
python main.py
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ú–æ–¥—É–ª–∏

- **main.py** - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è UI –∏ asyncio
- **ui_workflow.py** - –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- **main_workflow.py** - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- **llm_subworkflow.py** - —Ä–∞–±–æ—Ç–∞ —Å LLM –∏ —Å–∫–æ—Ä–∏–Ω–≥ –º–æ–¥–µ–ª–µ–π
- **rag_subworkflow.py** - vector database –∏ RAG –∑–∞–ø—Ä–æ—Å—ã
- **doc_processing.py** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
- **chat_monitor.py** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram
- **proactive_workflow.py** - –ø—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–µ –∞–≥–µ–Ω—Ç—ã
- **db.py** - —Ä–∞–±–æ—Ç–∞ —Å SQLite
- **env_loader.py** - –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- **translate.py** - –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- **embeddings.py** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–æ–≤

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

SQLite —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏:
- `settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã
- `queue` - –æ—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π
- `history` - –∏—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤
- `free_llms` - —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π
- `model_scores` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∫–æ—Ä–∏–Ω–≥–∞
- `llm_name` - –ø—Ä–∏–≤—è–∑–∫–∞ –º–æ–¥–µ–ª–µ–π –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- `blacklist` - —á–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫
- `doc_state` - —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. **Services** - —Å—Ç–∞—Ç—É—Å API –∫–ª—é—á–µ–π
2. **Bot Control** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–æ–º –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
3. **Monitor** - –ª–æ–≥–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏

- **Role Blacklist** - –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–æ–ª–µ–π
- **Remove emojis** - –æ—á–∏—Å—Ç–∫–∞ —ç–º–æ–¥–∑–∏ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π
- **Save all messages** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- **Only free LLMs** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
- **Monitor chat** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —á–∞—Ç–∞

### –°–∫–æ—Ä–∏–Ω–≥ –º–æ–¥–µ–ª–µ–π

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –≤—Å–µ –º–æ–¥–µ–ª–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–æ–ø-N –º–æ–¥–µ–ª–µ–π
3. –ö–∞–∂–¥—ã–µ M –∏—Ç–µ—Ä–∞—Ü–∏–π –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥
4. –ó–∞–∫—Ä–µ–ø–ª—è–µ—Ç –ª—É—á—à—É—é –º–æ–¥–µ–ª—å –∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

### –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–µ –∞–≥–µ–Ω—Ç—ã

–ü—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (INACTIVITY_N * random(MIN, MAX) –º–∏–Ω—É—Ç) AGITATOR –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É.

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `.env`:

```env
# Vector DB
VECTOR_DB=pinecone
EMBED_DIM=384
RAG_TOPK_DOCS=5
RAG_TOPK_USER=10

# Chunking
CHUNK_LENGTH=300
OVERLAP=50

# Scoring
SCORE_TOP_N=10
SCORE_REFRESH_EVERY=5
QUALITY_THRESHOLD=7.0
TRIAL_COUNT=3

# Proactive
INACTIVITY_N=10
RANDOM_MULTIPLIER_MIN=1
RANDOM_MULTIPLIER_MAX=5

# Temperatures
TECH_temp=0.1
FRIEND_temp=0.9
ADVISOR_temp=0.4
AGITATOR_temp=0.5
OPERATOR_temp=0.3
```

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
