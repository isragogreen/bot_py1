# Changelog

## Обновление системы логирования и UI

### Добавлено

#### 1. Новая система логирования (`logger.py`)
- **4 уровня логирования**: DEBUG, INFO, WARNING, ERROR
- **Цветовая кодировка** в консоли и UI
- **Компонентная структура** - каждый модуль имеет свой тег
- **Thread-safe** передача логов в UI через callback
- **Фильтрация** по уровням в реальном времени

#### 2. Улучшенный UI Monitor
- **Счетчик обработанных сообщений** - отдельный от размера очереди
- **Блок Recent Messages** - отображение последних сообщений:
  - Входящие сообщения (синий цвет, стрелка ←)
  - Исходящие ответы (зеленый цвет, стрелка →)
  - Временные метки для каждого сообщения
  - Автоматическое ограничение до 50 последних сообщений
- **Event Log с цветовым выделением**:
  - DEBUG - голубой (cyan)
  - INFO - зеленый
  - WARNING - оранжевый
  - ERROR - красный
  - Автоматическое ограничение до 1000 строк

#### 3. Выбор уровня логирования в UI
- Радиокнопки в панели Bot Control
- Настройка сохраняется в БД
- Динамическое применение без перезапуска

#### 4. Комментарии на русском языке
- Все ключевые модули документированы
- Docstrings для классов и методов
- Пошаговое описание процессов
- Объяснение назначения каждой таблицы БД

### Изменено

#### `main.py`
- Добавлен `log_callback` для передачи логов в UI
- Улучшен `ui_callback` с поддержкой входящих/исходящих сообщений
- Полная документация на русском

#### `main_workflow.py`
- Все `print()` заменены на `logger.*()` с соответствующими уровнями
- Добавлены DEBUG логи для отслеживания каждого шага
- Пошаговое описание процесса обработки сообщений (14 шагов)
- Счетчик обработанных сообщений
- Уведомления UI о входящих/исходящих сообщениях

#### `ui_workflow.py`
- Новый блок статистики с двумя счетчиками
- Отдельный ScrolledText для Recent Messages
- Цветовое выделение в обоих блоках
- Метод `add_message()` для отображения диалогов
- Метод `add_log()` для цветного логирования
- Увеличено окно до 1100x750px для лучшей видимости

#### `README.md`
- Документация системы логирования
- Описание панели Monitor
- Объяснение цветовой кодировки
- Инструкции по выбору уровня логирования

### Технические детали

#### Архитектура логирования
```
logger.py (централизованный логгер)
    ↓
main.py (log_callback)
    ↓
ui_workflow.py (add_log с цветовым выделением)
```

#### Поток данных сообщений
```
Telegram → chat_monitor.py
    ↓
main_workflow.handle_incoming_message()
    ↓ (callback: incoming_message)
ui_workflow.add_message(is_incoming=True)

main_workflow.process_message()
    ↓ (генерация ответа)
    ↓ (callback: outgoing_message)
ui_workflow.add_message(is_incoming=False)
```

### Использование

#### Выбор уровня логирования
1. Откройте вкладку **Bot Control**
2. В секции **Log Level** выберите нужный уровень
3. Изменения применяются мгновенно

#### Просмотр сообщений
- Вкладка **Monitor** → секция **Recent Messages**
- Синие (←) - входящие от пользователей
- Зеленые (→) - исходящие ответы бота
- Серые временные метки

#### Мониторинг событий
- Вкладка **Monitor** → секция **Event Log**
- Цветовая кодировка по важности
- Прокрутка автоматически к последнему событию

### Примеры логов

```
[2025-10-07 14:30:15] [INFO   ] [MAIN] Main workflow initialized
[2025-10-07 14:30:16] [DEBUG  ] [RAG] Message upserted to RAG (namespace=user123)
[2025-10-07 14:30:17] [WARNING] [LLM] No model found for user123, using default
[2025-10-07 14:30:18] [ERROR  ] [TELEGRAM] Failed to send message: Connection timeout
```

### Примеры сообщений

```
[14:30:15] ← user123: Hello, how are you?
[14:30:17] → user123: I'm doing great! How can I help you today?
[14:30:25] ← user456: What's the weather like?
[14:30:27] → user456: I don't have access to weather data, but I can help with other questions!
```
